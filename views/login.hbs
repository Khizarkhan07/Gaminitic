<div class="row mt-5" style="
    justify-content: center;
">

    <div class="col-md-6">

        <div id="alert-tab" role="alert">

        </div>

        <form id="form-data" class="margin" action="/admin_signin" METHOD="POST" onsubmit="fetchData('/admin_signin','form-data', 'POST')">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-center links">
                        <h2>Login</h2>
                    </div>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-center links">
                        <div class="input-group form-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                            </div>
                            <input type="text" id="email" name="email" class="form-control" placeholder="username" required="">
                        </div>
                    </div>

                    <div class="d-flex justify-content-center links">
                        <div class="input-group form-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input id="pass" type="password" name="password" class="form-control" placeholder="password" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" required="">
                        </div>
                    </div>


                    <br>
                    <div class="d-flex justify-content-center links">
                        <button id="btn-login"  class="btn btn-primary">Login</button>
                    </div>
                </div>

                <div class="card-footer">
                    <div class="d-flex justify-content-center links">
                        <a id="anchor" href="/forgot-password"> Forgot your password?</a>
                    </div>
                </div>

            </div></form>
        <div class="col-md-4"></div>
    </div>

</div>

<script>
    // Check browser support
    if (typeof(Storage) !== "undefined") {
        if(localStorage.getItem("token")){
            location.replace("/disputes")
        }
        // Retrieve
    }



    async function fetchData(url, id, method) {
        event.preventDefault();

            const formData = document.getElementById(id);
            var body = JSON.stringify(Object.fromEntries(new FormData(formData)));
            console.log(body);
            let response = await fetch("https://gaminatic.hexaadev.com" + url, {
                method: method,
                body,
                headers: {
                    Accept: "application/json",
                    "Content-Type": "application/json",
                },
            });
            let result = await response.json();

            if (response.status >= 400 && response.status < 600) {
                result.errors.forEach((err) => {
                    console.log(err.msg)

                    diplayAlerts(err.msg, "danger");
                });
            } else {

                if (typeof(Storage) !== "undefined") {
                    // Store
                    const token = result.user.token;
                    const _id = result.user._id;
                    const name = result.user.name;
                    const email = result.user.email;
                    const role = result.user.role;
                    localStorage.setItem("token", token)
                    localStorage.setItem("_id", _id)
                    localStorage.setItem("name", name)
                    localStorage.setItem("email", email)
                    localStorage.setItem("role", role)

                    window.location.href= '/disputes'
                    // Retrieve

                    if(localStorage.getItem("token")){
                        var a = document.createElement('a');
                        var linkText = document.createTextNode("Logout");
                        a.appendChild(linkText);
                        a.classList.add("list-group-item")
                        a.classList.add("list-group-item-action")
                        a.classList.add("bg-light")
                        a.href = "https://www.gaminatic.hexaadev.com/login";
                        document.getElementById('side-menu').appendChild(a);
                    }

                    if(localStorage.getItem("name")) {
                        // Store
                        var Username = localStorage.getItem("name")
                        // Retrieve
                        document.getElementById("name-tag").innerHTML = "Welcome " + Username;


                    }
                }

            }
        }


    function diplayAlerts(err, classy){
        let node = document.createElement("p"); // Create a <li> node
        node.setAttribute("class","alert alert-"+classy);
        let t = document.createTextNode(err);
        node.appendChild(t);
        document.getElementById("alert-tab").appendChild(node);
        //setTimeout(function(){ document.getElementById("error-alerts").removeChild(node) }, 5000);
    }


</script>